<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>èƒŒè¯µç¥å™¨ v0.5 (é”™é¢˜é«˜äº®ç‰ˆ)</title>
    <style>
        :root {
            --bg-color: #1e1e1e;
            --text-color: #d4d4d4;
            --accent-color: #4ec9b0;
            --blur-bg: #4a4a4a;
            --missed-color: #f14c4c; /* é”™é¢˜çº¢è‰² */
            --highlight-bg: #ffd700; /* é«˜äº®é»„è‰² */
            --highlight-text: #1e1e1e;
            --sidebar-width: 50%;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            margin: 0;
            padding: 20px;
            display: flex;
            flex-direction: column;
            height: 100vh;
            box-sizing: border-box;
            transition: padding 0.3s;
        }

        /* é¡¶éƒ¨æ§åˆ¶æ  */
        .controls {
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-shrink: 0;
        }

        .header-left { display: flex; flex-direction: column; }
        h2 { margin: 0; color: var(--accent-color); font-size: 1.2rem; letter-spacing: 1px; }
        .hint { font-size: 0.8rem; opacity: 0.6; margin-top: 4px; }

        .btn-group { display: flex; gap: 10px; }
        button {
            border: none;
            padding: 8px 16px;
            color: #1e1e1e;
            font-weight: bold;
            cursor: pointer;
            border-radius: 4px;
            transition: opacity 0.2s, transform 0.1s;
            font-size: 14px;
        }
        button:active { transform: scale(0.98); }
        button:hover { opacity: 0.9; }

        .btn-reset { background: #ce9178; }
        .btn-toggle { background: #569cd6; color: white; }
        .btn-layout { background: var(--accent-color); }

        /* === å¸ƒå±€æ ¸å¿ƒ === */
        .container {
            display: flex;
            gap: 20px;
            flex: 1;
            min-height: 0;
            position: relative;
        }

        .input-box {
            flex: 0 0 var(--sidebar-width);
            display: flex;
            flex-direction: column;
            border: 1px solid #333;
            border-radius: 8px;
            padding: 20px;
            background: #252526;
            transition: all 0.4s cubic-bezier(0.25, 1, 0.5, 1);
            overflow: hidden;
            opacity: 1;
        }

        .input-box.hidden {
            flex: 0 0 0;
            padding: 20px 0;
            border-width: 0;
            opacity: 0;
            margin-right: -20px;
        }

        .preview-box {
            flex: 1;
            border: 1px solid #333;
            border-radius: 8px;
            padding: 40px;
            background: #252526;
            overflow-y: auto;
            display: block; 
            font-size: 20px;
            line-height: 1.9;
            white-space: pre-wrap;
            word-wrap: break-word;
            max-width: 100%;
        }

        textarea {
            flex: 1;
            background: transparent;
            color: var(--text-color);
            border: none;
            resize: none;
            outline: none;
            font-family: monospace;
            font-size: 14px;
            line-height: 1.6;
            width: 100%;
        }

        /* === æ ·å¼ç³»ç»Ÿ === */
        
        /* 1. æ¨¡ç³Šå— (Spoiler) */
        .spoiler {
            background-color: var(--blur-bg);
            color: transparent;
            text-shadow: 0 0 12px rgba(255,255,255,0.4);
            border-radius: 4px;
            padding: 0 5px;
            cursor: pointer;
            user-select: none;
            transition: all 0.2s ease;
            -webkit-box-decoration-break: clone;
            box-decoration-break: clone;
            border: 1px solid transparent; /* é¢„ç•™è¾¹æ¡†ä½ç½® */
        }

        /* æ­£å¸¸ç‚¹å‡»æ­ç¤º */
        .spoiler.revealed {
            background-color: rgba(78, 201, 176, 0.15);
            color: var(--accent-color);
            text-shadow: none;
            border-bottom: 2px solid var(--accent-color);
            border-radius: 0;
        }

        /* ğŸ”´ é”™é¢˜æ ‡è®° (Missed/Hard) */
        .spoiler.missed {
            background-color: rgba(241, 76, 76, 0.2) !important;
            color: var(--missed-color) !important;
            text-shadow: none !important;
            border: 1px solid var(--missed-color);
            border-bottom: 3px solid var(--missed-color); /* åŠ é‡åº•éƒ¨ */
            font-weight: bold;
        }

        /* ğŸŸ¡ é™æ€é«˜äº® (Highlight) ==text== */
        mark {
            background-color: var(--highlight-bg);
            color: var(--highlight-text);
            border-radius: 2px;
            padding: 0 4px;
            font-weight: bold;
        }

        /* æçº²æ¨¡å¼ */
        .hardcore-mode { color: transparent !important; text-shadow: none !important; }
        .hardcore-mode .spoiler { 
            background-color: transparent !important; 
            box-shadow: none !important; 
            border: none !important; 
            pointer-events: none; 
        }
        .hardcore-mode mark {
            background: transparent; color: transparent; /* é«˜äº®ä¹Ÿéšèº« */
        }
        .hardcore-mode h3 {
            color: var(--accent-color) !important;
            opacity: 0.8;
            border-bottom: 1px dashed #333;
            padding-bottom: 10px;
        }

    </style>
</head>
<body>

    <div class="controls">
        <div class="header-left">
            <h2>Markdown èƒŒè¯µæœº v0.5</h2>
            <span class="hint">å³é”®ç‚¹å‡»æ¨¡ç³Šå— = æ ‡è®°æ²¡è®°ä½ | ä½¿ç”¨ ==æ–‡å­—== é«˜äº®</span>
        </div>
        <div class="btn-group">
            <button class="btn-layout" onclick="toggleLayout()">â†”ï¸ åˆ‡æ¢å…¨å±</button>
            <button class="btn-toggle" onclick="toggleHardcore()">ğŸ”¥ æçº²æ¨¡å¼</button>
            <button class="btn-reset" onclick="resetAll()">ğŸ”„ é‡ç½®çŠ¶æ€</button>
        </div>
    </div>

    <div class="container">
        <div class="input-box" id="inputBox">
            <textarea id="inputArea" placeholder="è¾“å…¥ç¬”è®°...&#10;&#10;1. ä½¿ç”¨ **å†…å®¹** æŒ–ç©ºã€‚&#10;2. ä½¿ç”¨ ==å†…å®¹== é«˜äº®ã€‚&#10;3. å³é”®ç‚¹å‡»æ¨¡ç³Šå—æ ‡è®°ä¸ºçº¢è‰²ã€‚"></textarea>
        </div>

        <div class="box preview-box" id="preview"></div>
    </div>

    <script>
        const inputArea = document.getElementById('inputArea');
        const preview = document.getElementById('preview');
        const inputBox = document.getElementById('inputBox');

        // å®æ—¶æ¸²æŸ“
        inputArea.addEventListener('input', () => {
            render(inputArea.value);
            localStorage.setItem('reciteContent', inputArea.value);
        });

        function render(text) {
            let html = text.replace(/&/g, "&amp;").replace(/</g, "&lt;").replace(/>/g, "&gt;");
            
            // æ ‡é¢˜
            html = html.replace(/^## (.*$)/gim, '<h3 style="margin:1.5em 0 0.8em; color:#4ec9b0; font-size:1.4em;">$1</h3>');
            
            // ğŸŸ¡ é«˜äº®è¯­æ³• ==text== -> <mark>text</mark>
            html = html.replace(/==(.*?)==/g, '<mark>$1</mark>');

            // â¬› æ¨¡ç³Šè¯­æ³• **text** -> span.spoiler
            // å¢åŠ  oncontextmenu äº‹ä»¶ç›‘å¬å³é”®
            html = html.replace(/\*\*(.*?)\*\*/g, '<span class="spoiler" onclick="toggleReveal(this)" oncontextmenu="markAsMissed(event, this)">$1</span>');
            
            preview.innerHTML = html;
        }

        // å·¦é”®ï¼šæ™®é€šæ­ç¤º
        function toggleReveal(element) {
            // å¦‚æœå·²ç»æ˜¯æ ‡è®°ä¸ºé”™é¢˜çš„çŠ¶æ€ï¼Œç‚¹å‡»å·¦é”®å¯ä»¥å–æ¶ˆé”™é¢˜çŠ¶æ€ï¼Œæˆ–è€…åªæ˜¯æ™®é€šæ­ç¤º
            // è¿™é‡Œé€»è¾‘è®¾å®šä¸ºï¼šç‚¹å‡»æ€»æ˜¯åˆ‡æ¢å¯è§æ€§
            element.classList.toggle('revealed');
        }

        // ğŸ‘‰ å³é”®ï¼šæ ‡è®°ä¸ºâ€œæ²¡è®°ä½â€ (çº¢è‰²)
        function markAsMissed(event, element) {
            event.preventDefault(); // é˜»æ­¢æµè§ˆå™¨é»˜è®¤å³é”®èœå•
            
            // åˆ‡æ¢ 'missed' ç±»
            if (element.classList.contains('missed')) {
                element.classList.remove('missed');
                element.classList.remove('revealed'); // é¡ºä¾¿ç›–å›å»
            } else {
                element.classList.add('missed');
                element.classList.add('revealed'); // æ ‡è®°é”™é¢˜æ—¶è‚¯å®šè¦è®©ä½ çœ‹åˆ°ç­”æ¡ˆæ˜¯å•¥
            }
        }

        function resetAll() {
            // é‡ç½®æ‰€æœ‰çŠ¶æ€ï¼šæ¨¡ç³Šçš„ã€é”™é¢˜çš„éƒ½æ¢å¤åŸæ ·
            document.querySelectorAll('.spoiler').forEach(el => {
                el.classList.remove('revealed');
                el.classList.remove('missed');
            });
        }

        function toggleHardcore() {
            preview.classList.toggle('hardcore-mode');
        }

        function toggleLayout() {
            inputBox.classList.toggle('hidden');
        }

        window.onload = function() {
            const saved = localStorage.getItem('reciteContent');
            if (saved) {
                inputArea.value = saved;
                render(saved);
            } else {
                const defaultText = "## ä½¿ç”¨æŒ‡å—\n1. æ­£å¸¸ç‚¹å‡»æ¨¡ç³Šå— = **æŸ¥çœ‹ç­”æ¡ˆ**\n2. é¼ æ ‡å³é”®ç‚¹å‡» = **æ ‡è®°ä¸ºæ²¡è®°ä½** (å˜çº¢)\n3. ä½¿ç”¨ç­‰å·åŒ…è£¹ = ==è¿™ä¸ªæ˜¯æç¤ºé‡ç‚¹==\n\nå¿«å»è¯•è¯•å§ï¼";
                inputArea.value = defaultText;
                render(defaultText);
            }
        }
    </script>
</body>
</html>